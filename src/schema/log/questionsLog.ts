import * as yup from 'yup';
import { questionSchema } from '../question';
import { objectOf } from '../utils/objectOf';
import { optionalTimestampSchema, timestampSchema } from '../utils/timestamp';
import { logBaseSchema } from './base';
import { gptResponseMixin } from './utils/gpt';

export const questionDataSchema = yup.object({
  numericValue: yup.number(),
  stringValue: yup.string().required(),
  unit: yup.string().required(),
  setAt: timestampSchema,
});
export type QuestionDataValue = yup.InferType<typeof questionDataSchema>;

export const questionsLogSchema = logBaseSchema('questions').shape({
  questionsById: objectOf(questionSchema),
  questionData: objectOf(questionDataSchema),
  submittedAt: optionalTimestampSchema,
  ...gptResponseMixin, // These logs can be generated by OpenAI
});

export type QuestionsLogValue = yup.InferType<typeof questionsLogSchema>;
